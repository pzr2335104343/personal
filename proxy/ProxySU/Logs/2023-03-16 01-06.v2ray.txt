正在与服务器建立连接
建立连接成功
sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
if [[ -f /usr/local/bin/v2ray ]];then echo '1';else echo '0'; fi
0
1. 检测系统环境
检测CPU架构
uname -m
x86_64
检测系统安装命令
command -v apt
/usr/bin/apt
检测Systemctl
command -v systemctl
/usr/bin/systemctl
检测SELinux
command -v getenforce

2. 安装必要的系统工具
更新安装包
apt update -y
Hit:1 https://deb.debian.org/debian buster InRelease
Hit:2 https://deb.debian.org/debian-security buster/updates InRelease
Hit:3 https://deb.debian.org/debian buster-updates InRelease
Hit:4 https://apprepo.vultr.com/debian universal InRelease
Reading package lists...
Building dependency tree...
Reading state information...
All packages are up to date.
安装sudo工具
command -v sudo
/usr/bin/sudo
安装curl工具
command -v curl
/usr/bin/curl
安装wget工具
command -v wget
/usr/bin/wget
安装ping工具
command -v ping
/usr/bin/ping
安装unzip工具
command -v unzip
/usr/bin/unzip
安装cron工具
command -v cron
/usr/sbin/cron
安装lsof工具
command -v lsof
/usr/bin/lsof
安装systemd工具
command -v systemd
/usr/bin/systemd
3. 配置防火墙
释放被占用的端口
lsof -n -P -i :80 | grep LISTEN

lsof -n -P -i :443 | grep LISTEN

开放需要的端口
command -v firewall-cmd

command -v ufw
/usr/sbin/ufw
ufw allow 22/tcp
Skipping adding existing rule
Skipping adding existing rule (v6)
ufw allow 80/tcp
Rule added
Rule added (v6)
ufw allow 80/udp
Rule added
Rule added (v6)
ufw allow 443/tcp
Rule added
Rule added (v6)
ufw allow 443/udp
Rule added
Rule added (v6)
yes | ufw reload
Firewall reloaded
4. 检测网络环境
检测IPv4
curl -4 ip.sb
207.246.103.112
IPv4地址为207.246.103.112
5. 同步系统和本地时间
rm -f /etc/localtime

ln -s /usr/share/zoneinfo/UTC /etc/localtime

date +%s
1678941172
5. 安装Caddy服务器
rm -rf caddy.tar.gz

rm -rf /etc/caddy

rm -rf /usr/share/caddy

wget -O caddy.tar.gz https://github.com/caddyserver/caddy/releases/download/v2.4.3/caddy_2.4.3_linux_amd64.tar.gz

mkdir /etc/caddy

tar -zxvf caddy.tar.gz -C /etc/caddy
LICENSE
README.md
caddy
cp -rf /etc/caddy/caddy /usr/bin

systemctl daemon-reload

systemctl enable caddy

mkdir /usr/share/caddy

chmod 775 /usr/share/caddy

if [[ -f /usr/bin/caddy ]];then echo '1';else echo '0'; fi
1
6. 安装V2ray-Core
开始安装V2ray-Core
bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)
info: Installing V2Ray v5.3.0 for x86_64
Downloading V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v5.3.0/v2ray-linux-64.zip
Downloading verification file for V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v5.3.0/v2ray-linux-64.zip.dgst
info: Extract the V2Ray package to /tmp/tmp.ZcAM4Riate and prepare it for installation.
info: Systemd service files have been installed successfully!
warning: The following are the actual parameters for the v2ray service startup.
warning: Please make sure the configuration file path is correctly set.
# /etc/systemd/system/v2ray.service
[Unit]
Description=V2Ray Service
Documentation=https://www.v2fly.org/
After=network.target nss-lookup.target

[Service]
User=nobody
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
NoNewPrivileges=true
ExecStart=/usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json
Restart=on-failure
RestartPreventExitStatus=23

[Install]
WantedBy=multi-user.target

# /etc/systemd/system/v2ray.service.d/10-donot_touch_single_conf.conf
# In case you have a good reason to do so, duplicate this file in the same directory and make your customizes there.
# Or all changes you made will be lost!  # Refer: https://www.freedesktop.org/software/systemd/man/systemd.unit.html
[Service]
ExecStart=
ExecStart=/usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json

installed: /usr/local/bin/v2ray
installed: /usr/local/share/v2ray/geoip.dat
installed: /usr/local/share/v2ray/geosite.dat
installed: /usr/local/etc/v2ray/config.json
installed: /var/log/v2ray/
installed: /var/log/v2ray/access.log
installed: /var/log/v2ray/error.log
installed: /etc/systemd/system/v2ray.service
installed: /etc/systemd/system/v2ray@.service
removed: /tmp/tmp.ZcAM4Riate
info: V2Ray v5.3.0 is installed.
You may need to execute a command to remove dependent software: apt purge curl unzip
Please execute the command: systemctl enable v2ray; systemctl start v2ray
if [[ -f /usr/local/bin/v2ray ]];then echo '1';else echo '0'; fi
1
设置V2ray-Core权限
sed -i 's/User=nobody/User=root/g' /etc/systemd/system/v2ray.service

sed -i 's/CapabilityBoundingSet=/#CapabilityBoundingSet=/g' /etc/systemd/system/v2ray.service

sed -i 's/AmbientCapabilities=/#AmbientCapabilities=/g' /etc/systemd/system/v2ray.service

systemctl daemon-reload

systemctl enable v2ray

if [[ -f /usr/local/etc/v2ray/config.json ]];then echo '1';else echo '0'; fi
1
mv /usr/local/etc/v2ray/config.json /usr/local/etc/v2ray/config.json.1

安装TLS证书
安装Acme软件
apt install -y socat
Reading package lists...
Building dependency tree...
Reading state information...
The following NEW packages will be installed:
  socat
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 358 kB of archives.
After this operation, 1,034 kB of additional disk space will be used.
Get:1 https://deb.debian.org/debian buster/main amd64 socat amd64 1.7.3.2-2 [358 kB]
Fetched 358 kB in 0s (9,900 kB/s)
Selecting previously unselected package socat.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 70445 files and directories currently installed.)
Preparing to unpack .../socat_1.7.3.2-2_amd64.deb ...
Unpacking socat (1.7.3.2-2) ...
Setting up socat (1.7.3.2-2) ...
Processing triggers for man-db (2.8.5-2) ...
apt install -y automake autoconf libtool
Reading package lists...
Building dependency tree...
Reading state information...
The following additional packages will be installed:
  autotools-dev libltdl-dev libltdl7 libsigsegv2 m4
Suggested packages:
  autoconf-archive gnu-standards autoconf-doc gettext libtool-doc gfortran
  | fortran95-compiler gcj-jdk m4-doc
The following NEW packages will be installed:
  autoconf automake autotools-dev libltdl-dev libltdl7 libsigsegv2 libtool m4
0 upgraded, 8 newly installed, 0 to remove and 0 not upgraded.
Need to get 2,524 kB of archives.
After this operation, 6,957 kB of additional disk space will be used.
Get:1 https://deb.debian.org/debian buster/main amd64 libsigsegv2 amd64 2.12-2 [32.8 kB]
Get:2 https://deb.debian.org/debian buster/main amd64 m4 amd64 1.4.18-2 [203 kB]
Get:3 https://deb.debian.org/debian buster/main amd64 autoconf all 2.69-11 [341 kB]
Get:4 https://deb.debian.org/debian buster/main amd64 autotools-dev all 20180224.1 [77.0 kB]
Get:5 https://deb.debian.org/debian buster/main amd64 automake all 1:1.16.1-4 [771 kB]
Get:6 https://deb.debian.org/debian buster/main amd64 libltdl7 amd64 2.4.6-9 [390 kB]
Get:7 https://deb.debian.org/debian buster/main amd64 libltdl-dev amd64 2.4.6-9 [162 kB]
Get:8 https://deb.debian.org/debian buster/main amd64 libtool all 2.4.6-9 [547 kB]
Fetched 2,524 kB in 0s (28.9 MB/s)
Selecting previously unselected package libsigsegv2:amd64.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 70486 files and directories currently installed.)
Preparing to unpack .../0-libsigsegv2_2.12-2_amd64.deb ...
Unpacking libsigsegv2:amd64 (2.12-2) ...
Selecting previously unselected package m4.
Preparing to unpack .../1-m4_1.4.18-2_amd64.deb ...
Unpacking m4 (1.4.18-2) ...
Selecting previously unselected package autoconf.
Preparing to unpack .../2-autoconf_2.69-11_all.deb ...
Unpacking autoconf (2.69-11) ...
Selecting previously unselected package autotools-dev.
Preparing to unpack .../3-autotools-dev_20180224.1_all.deb ...
Unpacking autotools-dev (20180224.1) ...
Selecting previously unselected package automake.
Preparing to unpack .../4-automake_1%3a1.16.1-4_all.deb ...
Unpacking automake (1:1.16.1-4) ...
Selecting previously unselected package libltdl7:amd64.
Preparing to unpack .../5-libltdl7_2.4.6-9_amd64.deb ...
Unpacking libltdl7:amd64 (2.4.6-9) ...
Selecting previously unselected package libltdl-dev:amd64.
Preparing to unpack .../6-libltdl-dev_2.4.6-9_amd64.deb ...
Unpacking libltdl-dev:amd64 (2.4.6-9) ...
Selecting previously unselected package libtool.
Preparing to unpack .../7-libtool_2.4.6-9_all.deb ...
Unpacking libtool (2.4.6-9) ...
Setting up autotools-dev (20180224.1) ...
Setting up libsigsegv2:amd64 (2.12-2) ...
Setting up libltdl7:amd64 (2.4.6-9) ...
Setting up libtool (2.4.6-9) ...
Setting up m4 (1.4.18-2) ...
Setting up autoconf (2.69-11) ...
Setting up automake (1:1.16.1-4) ...
update-alternatives: using /usr/bin/automake-1.16 to provide /usr/bin/automake (automake) in auto mode
Setting up libltdl-dev:amd64 (2.4.6-9) ...
Processing triggers for man-db (2.8.5-2) ...
Processing triggers for libc-bin (2.28-10+deb10u2) ...
curl  https://get.acme.sh yes | sh
[Thu 16 Mar 2023 04:33:21 AM UTC] Installing from online archive.
[Thu 16 Mar 2023 04:33:21 AM UTC] Downloading https://github.com/acmesh-official/acme.sh/archive/master.tar.gz
[Thu 16 Mar 2023 04:33:21 AM UTC] Extracting master.tar.gz
[Thu 16 Mar 2023 04:33:21 AM UTC] Installing to /root/.acme.sh
[Thu 16 Mar 2023 04:33:21 AM UTC] Installed to /root/.acme.sh/acme.sh
[Thu 16 Mar 2023 04:33:21 AM UTC] Installing alias to '/root/.bashrc'
[Thu 16 Mar 2023 04:33:21 AM UTC] OK, Close and reopen your terminal to start using acme.sh
[Thu 16 Mar 2023 04:33:21 AM UTC] Installing cron job
[Thu 16 Mar 2023 04:33:21 AM UTC] Good, bash is found, so change the shebang to use bash as preferred.
[Thu 16 Mar 2023 04:33:22 AM UTC] OK
[Thu 16 Mar 2023 04:33:22 AM UTC] Install success!
alias acme.sh=~/.acme.sh/acme.sh

正在申请证书
/root/.acme.sh/acme.sh --force --debug --issue  --standalone  -d   --pre-hook "systemctl stop caddy"  --post-hook  "systemctl start caddy" --server letsencrypt

申请证书失败，如果申请次数过多请更换二级域名，或联系开发者！
更新V2ray配置
sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
0. 检测系统环境
检测CPU架构
uname -m
x86_64
检测系统安装命令
检测Systemctl
command -v systemctl
/usr/bin/systemctl
检测SELinux
command -v getenforce

1. 配置防火墙
systemctl stop v2ray

systemctl stop caddy

释放被占用的端口
lsof -n -P -i :80 | grep LISTEN

lsof -n -P -i :443 | grep LISTEN

开放需要的端口
command -v firewall-cmd

command -v ufw
/usr/sbin/ufw
ufw allow 22/tcp
Skipping adding existing rule
Skipping adding existing rule (v6)
ufw allow 80/tcp
Skipping adding existing rule
Skipping adding existing rule (v6)
ufw allow 80/udp
Skipping adding existing rule
Skipping adding existing rule (v6)
ufw allow 443/tcp
Skipping adding existing rule
Skipping adding existing rule (v6)
ufw allow 443/udp
Skipping adding existing rule
Skipping adding existing rule (v6)
yes | ufw reload
Firewall reloaded
2. 上传V2ray配置文件
3. 上传Caddy配置文件
if [[ -f /etc/caddy/Caddyfile ]];then echo '1';else echo '0'; fi
1
mv /etc/caddy/Caddyfile /etc/caddy/Caddyfile.back

4. 重启v2ray服务
systemctl restart caddy

systemctl restart v2ray

更新配置成功
更新V2ray-Core
sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
下载最新版本V2ray-Core
检测CPU架构
uname -m
x86_64
检测系统安装命令
检测Systemctl
command -v systemctl
/usr/bin/systemctl
检测SELinux
command -v getenforce

bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)
info: No new version. The current version of V2Ray is v5.3.0 .
systemctl restart v2ray

更新V2ray-Core成功
sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
if [[ -f /usr/local/bin/v2ray ]];then echo '1';else echo '0'; fi
1
sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
1. 检测系统环境
检测系统环境
检测CPU架构
uname -m
x86_64
检测系统安装命令
检测Systemctl
command -v systemctl
/usr/bin/systemctl
检测SELinux
command -v getenforce

2. 卸载Caddy服务
关闭Caddy服务
systemctl stop caddy

systemctl disable caddy

彻底删除Caddy文件
rm -rf /etc/systemd/system/caddy.service

rm -rf /usr/bin/caddy

rm -rf /usr/share/caddy

rm -rf /etc/caddy

3. 卸载V2ray服务
关闭V2ray服务
systemctl stop v2ray

systemctl disable v2ray

卸载V2ray
bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh) --remove
removed: /usr/local/bin/v2ray
removed: /usr/local/share/v2ray
removed: /etc/systemd/system/v2ray.service
removed: /etc/systemd/system/v2ray@.service
removed: /etc/systemd/system/v2ray.service.d
removed: /etc/systemd/system/v2ray@.service.d
Please execute the command: systemctl disable v2ray
You may need to execute a command to remove dependent software: apt purge curl unzip
info: V2Ray has been removed.
info: If necessary, manually delete the configuration and log files.
info: e.g., /usr/local/etc/v2ray and /var/log/v2ray/ ...
4. 卸载Acme证书申请服务
卸载 acme.sh
acme.sh --uninstall

删除 acme.sh 相关文件
rm -rf ~/.acme.sh

5. 重置防火墙端口
command -v firewall-cmd

command -v ufw
/usr/sbin/ufw
ufw delete allow 80/tcp
Rule deleted
Rule deleted (v6)
ufw delete allow 80/udp
Rule deleted
Rule deleted (v6)
ufw delete allow 443/tcp
Rule deleted
Rule deleted (v6)
ufw delete allow 443/udp
Rule deleted
Rule deleted (v6)
yes | ufw reload
Firewall reloaded
卸载完成
卸载完成
sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
if [[ -f /usr/local/bin/v2ray ]];then echo '1';else echo '0'; fi
0
1. 检测系统环境
检测CPU架构
uname -m
x86_64
检测系统安装命令
检测Systemctl
command -v systemctl
/usr/bin/systemctl
检测SELinux
command -v getenforce

2. 安装必要的系统工具
更新安装包
apt update -y
Hit:1 https://deb.debian.org/debian buster InRelease
Hit:2 https://deb.debian.org/debian-security buster/updates InRelease
Hit:3 https://deb.debian.org/debian buster-updates InRelease
Hit:4 https://apprepo.vultr.com/debian universal InRelease
Reading package lists...
Building dependency tree...
Reading state information...
All packages are up to date.
安装sudo工具
command -v sudo
/usr/bin/sudo
安装curl工具
command -v curl
/usr/bin/curl
安装wget工具
command -v wget
/usr/bin/wget
安装ping工具
command -v ping
/usr/bin/ping
安装unzip工具
command -v unzip
/usr/bin/unzip
安装cron工具
command -v cron
/usr/sbin/cron
安装lsof工具
command -v lsof
/usr/bin/lsof
安装systemd工具
command -v systemd
/usr/bin/systemd
3. 配置防火墙
释放被占用的端口
lsof -n -P -i :80 | grep LISTEN

lsof -n -P -i :443 | grep LISTEN
续签证书
检测系统环境
sed -i 's/echo/#echo/g' ~/.bashrc


sed -i 's/echo/#echo/g' ~/.profile
开放需要的端口
command -v firewall-cmd


id -u
command -v ufw
0
/usr/sbin/ufw
ufw allow 22/tcp
检测CPU架构
uname -m
x86_64
检测系统安装命令
检测Systemctl
command -v systemctl
Skipping adding existing rule
Skipping adding existing rule (v6)
ufw allow 80/tcp
/usr/bin/systemctl
检测SELinux
command -v getenforce
Rule added
Rule added (v6)
ufw allow 80/udp

Rule added
Rule added (v6)
ufw allow 443/tcp
安装证书
安装Acme软件
apt install -y socat
Rule added
Rule added (v6)
ufw allow 443/udp
Reading package lists...
Building dependency tree...
Reading state information...
socat is already the newest version (1.7.3.2-2).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
apt install -y automake autoconf libtool
Rule added
Rule added (v6)
yes | ufw reload
Reading package lists...
Building dependency tree...
Reading state information...
autoconf is already the newest version (2.69-11).
automake is already the newest version (1:1.16.1-4).
libtool is already the newest version (2.4.6-9).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
curl  https://get.acme.sh yes | sh
Firewall reloaded
4. 检测网络环境
检测IPv4
curl -4 ip.sb
207.246.103.112
IPv4地址为207.246.103.112
5. 同步系统和本地时间
rm -f /etc/localtime

ln -s /usr/share/zoneinfo/UTC /etc/localtime

date +%s
1678941463
5. 安装Caddy服务器
rm -rf caddy.tar.gz

rm -rf /etc/caddy

rm -rf /usr/share/caddy

wget -O caddy.tar.gz https://github.com/caddyserver/caddy/releases/download/v2.4.3/caddy_2.4.3_linux_amd64.tar.gz

mkdir /etc/caddy

[Thu 16 Mar 2023 04:37:45 AM UTC] Installing from online archive.
[Thu 16 Mar 2023 04:37:45 AM UTC] Downloading https://github.com/acmesh-official/acme.sh/archive/master.tar.gz
[Thu 16 Mar 2023 04:37:46 AM UTC] Extracting master.tar.gz
[Thu 16 Mar 2023 04:37:46 AM UTC] Installing to /root/.acme.sh
[Thu 16 Mar 2023 04:37:46 AM UTC] Installed to /root/.acme.sh/acme.sh
[Thu 16 Mar 2023 04:37:46 AM UTC] Installing alias to '/root/.bashrc'
[Thu 16 Mar 2023 04:37:46 AM UTC] OK, Close and reopen your terminal to start using acme.sh
[Thu 16 Mar 2023 04:37:46 AM UTC] Installing cron job
21 0 * * * "/root/.acme.sh"/acme.sh --cron --home "/root/.acme.sh" > /dev/null
[Thu 16 Mar 2023 04:37:46 AM UTC] Good, bash is found, so change the shebang to use bash as preferred.
[Thu 16 Mar 2023 04:37:47 AM UTC] OK
[Thu 16 Mar 2023 04:37:47 AM UTC] Install success!
tar -zxvf caddy.tar.gz -C /etc/caddy
alias acme.sh=~/.acme.sh/acme.sh

正在申请证书
/root/.acme.sh/acme.sh --force --debug --issue  --standalone  -d   --pre-hook "systemctl stop caddy"  --post-hook  "systemctl start caddy" --server letsencrypt
LICENSE
README.md
caddy
cp -rf /etc/caddy/caddy /usr/bin

申请证书失败，如果申请次数过多请更换二级域名，或联系开发者！

sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
1. 检测系统环境
检测系统环境
检测CPU架构
uname -m
x86_64
检测系统安装命令
检测Systemctl
command -v systemctl
/usr/bin/systemctl
检测SELinux
command -v getenforce

2. 卸载Caddy服务
关闭Caddy服务
systemctl stop caddy

systemctl disable caddy
systemctl daemon-reload

彻底删除Caddy文件
rm -rf /etc/systemd/system/caddy.service


systemctl enable caddy
rm -rf /usr/bin/caddy

mkdir /usr/share/caddy

rm -rf /usr/share/caddy

chmod 775 /usr/share/caddy

rm -rf /etc/caddy

if [[ -f /usr/bin/caddy ]];then echo '1';else echo '0'; fi

3. 卸载V2ray服务
关闭V2ray服务
systemctl stop v2ray
0

systemctl disable v2ray

卸载V2ray
bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh) --remove
error: V2Ray is not installed.
4. 卸载Acme证书申请服务
卸载 acme.sh
acme.sh --uninstall

删除 acme.sh 相关文件
rm -rf ~/.acme.sh

5. 重置防火墙端口
command -v firewall-cmd

command -v ufw
/usr/sbin/ufw
ufw delete allow 80/tcp
Rule deleted
Rule deleted (v6)
ufw delete allow 80/udp
Rule deleted
Rule deleted (v6)
ufw delete allow 443/tcp
Rule deleted
Rule deleted (v6)
ufw delete allow 443/udp
Rule deleted
Rule deleted (v6)
yes | ufw reload
Firewall reloaded
卸载完成
卸载完成
sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
if [[ -f /usr/local/bin/v2ray ]];then echo '1';else echo '0'; fi
1
1. 检测系统环境
检测CPU架构
uname -m
x86_64
检测系统安装命令
检测Systemctl
command -v systemctl
/usr/bin/systemctl
检测SELinux
command -v getenforce

2. 安装必要的系统工具
更新安装包
apt update -y
Hit:1 https://deb.debian.org/debian buster InRelease
Hit:2 https://deb.debian.org/debian-security buster/updates InRelease
Hit:3 https://deb.debian.org/debian buster-updates InRelease
Hit:4 https://apprepo.vultr.com/debian universal InRelease
Reading package lists...
Building dependency tree...
Reading state information...
All packages are up to date.
安装sudo工具
command -v sudo
/usr/bin/sudo
安装curl工具
command -v curl
/usr/bin/curl
安装wget工具
command -v wget
/usr/bin/wget
安装ping工具
command -v ping
/usr/bin/ping
安装unzip工具
command -v unzip
/usr/bin/unzip
安装cron工具
command -v cron
/usr/sbin/cron
安装lsof工具
command -v lsof
/usr/bin/lsof
安装systemd工具
command -v systemd
/usr/bin/systemd
3. 配置防火墙
释放被占用的端口
lsof -n -P -i :80 | grep LISTEN

lsof -n -P -i :443 | grep LISTEN

开放需要的端口
command -v firewall-cmd

command -v ufw
/usr/sbin/ufw
ufw allow 22/tcp
Skipping adding existing rule
Skipping adding existing rule (v6)
ufw allow 80/tcp
Rule added
Rule added (v6)
ufw allow 80/udp
Rule added
Rule added (v6)
ufw allow 443/tcp
Rule added
Rule added (v6)
ufw allow 443/udp
Rule added
Rule added (v6)
yes | ufw reload
Firewall reloaded
4. 检测网络环境
检测IPv4
curl -4 ip.sb
207.246.103.112
IPv4地址为207.246.103.112
5. 同步系统和本地时间
rm -f /etc/localtime

ln -s /usr/share/zoneinfo/UTC /etc/localtime

date +%s
1678941823
5. 安装Caddy服务器
rm -rf caddy.tar.gz

rm -rf /etc/caddy

rm -rf /usr/share/caddy

wget -O caddy.tar.gz https://github.com/caddyserver/caddy/releases/download/v2.4.3/caddy_2.4.3_linux_amd64.tar.gz

mkdir /etc/caddy

tar -zxvf caddy.tar.gz -C /etc/caddy
LICENSE
README.md
caddy
cp -rf /etc/caddy/caddy /usr/bin

systemctl daemon-reload

systemctl enable caddy

mkdir /usr/share/caddy

chmod 775 /usr/share/caddy

if [[ -f /usr/bin/caddy ]];then echo '1';else echo '0'; fi
1
6. 安装V2ray-Core
开始安装V2ray-Core
bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)
info: Installing V2Ray v5.3.0 for x86_64
Downloading V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v5.3.0/v2ray-linux-64.zip
Downloading verification file for V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v5.3.0/v2ray-linux-64.zip.dgst
info: Extract the V2Ray package to /tmp/tmp.cRGNC6zNeY and prepare it for installation.
info: Systemd service files have been installed successfully!
warning: The following are the actual parameters for the v2ray service startup.
warning: Please make sure the configuration file path is correctly set.
# /etc/systemd/system/v2ray.service
[Unit]
Description=V2Ray Service
Documentation=https://www.v2fly.org/
After=network.target nss-lookup.target

[Service]
User=nobody
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
NoNewPrivileges=true
ExecStart=/usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json
Restart=on-failure
RestartPreventExitStatus=23

[Install]
WantedBy=multi-user.target

# /etc/systemd/system/v2ray.service.d/10-donot_touch_single_conf.conf
# In case you have a good reason to do so, duplicate this file in the same directory and make your customizes there.
# Or all changes you made will be lost!  # Refer: https://www.freedesktop.org/software/systemd/man/systemd.unit.html
[Service]
ExecStart=
ExecStart=/usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json

installed: /usr/local/bin/v2ray
installed: /usr/local/share/v2ray/geoip.dat
installed: /usr/local/share/v2ray/geosite.dat
installed: /etc/systemd/system/v2ray.service
installed: /etc/systemd/system/v2ray@.service
removed: /tmp/tmp.cRGNC6zNeY
info: V2Ray v5.3.0 is installed.
You may need to execute a command to remove dependent software: apt purge curl unzip
Please execute the command: systemctl enable v2ray; systemctl start v2ray
if [[ -f /usr/local/bin/v2ray ]];then echo '1';else echo '0'; fi
1
设置V2ray-Core权限
sed -i 's/User=nobody/User=root/g' /etc/systemd/system/v2ray.service

sed -i 's/CapabilityBoundingSet=/#CapabilityBoundingSet=/g' /etc/systemd/system/v2ray.service

sed -i 's/AmbientCapabilities=/#AmbientCapabilities=/g' /etc/systemd/system/v2ray.service

systemctl daemon-reload

systemctl enable v2ray

if [[ -f /usr/local/etc/v2ray/config.json ]];then echo '1';else echo '0'; fi
1
mv /usr/local/etc/v2ray/config.json /usr/local/etc/v2ray/config.json.1

安装TLS证书
安装Acme软件
apt install -y socat
Reading package lists...
Building dependency tree...
Reading state information...
socat is already the newest version (1.7.3.2-2).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
apt install -y automake autoconf libtool
Reading package lists...
Building dependency tree...
Reading state information...
autoconf is already the newest version (2.69-11).
automake is already the newest version (1:1.16.1-4).
libtool is already the newest version (2.4.6-9).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
curl  https://get.acme.sh yes | sh
[Thu 16 Mar 2023 04:44:10 AM UTC] Installing from online archive.
[Thu 16 Mar 2023 04:44:10 AM UTC] Downloading https://github.com/acmesh-official/acme.sh/archive/master.tar.gz
[Thu 16 Mar 2023 04:44:10 AM UTC] Extracting master.tar.gz
[Thu 16 Mar 2023 04:44:10 AM UTC] Installing to /root/.acme.sh
[Thu 16 Mar 2023 04:44:10 AM UTC] Installed to /root/.acme.sh/acme.sh
[Thu 16 Mar 2023 04:44:11 AM UTC] Installing alias to '/root/.bashrc'
[Thu 16 Mar 2023 04:44:11 AM UTC] OK, Close and reopen your terminal to start using acme.sh
[Thu 16 Mar 2023 04:44:11 AM UTC] Installing cron job
21 0 * * * "/root/.acme.sh"/acme.sh --cron --home "/root/.acme.sh" > /dev/null
[Thu 16 Mar 2023 04:44:11 AM UTC] Good, bash is found, so change the shebang to use bash as preferred.
[Thu 16 Mar 2023 04:44:11 AM UTC] OK
[Thu 16 Mar 2023 04:44:11 AM UTC] Install success!
alias acme.sh=~/.acme.sh/acme.sh

正在申请证书
/root/.acme.sh/acme.sh --force --debug --issue  --standalone  -d   --pre-hook "systemctl stop caddy"  --post-hook  "systemctl start caddy" --server letsencrypt

申请证书失败，如果申请次数过多请更换二级域名，或联系开发者！
sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
1. 检测系统环境
检测系统环境
检测CPU架构
uname -m
x86_64
检测系统安装命令
检测Systemctl
command -v systemctl
/usr/bin/systemctl
检测SELinux
command -v getenforce

2. 卸载Caddy服务
关闭Caddy服务
systemctl stop caddy

systemctl disable caddy

彻底删除Caddy文件
rm -rf /etc/systemd/system/caddy.service

rm -rf /usr/bin/caddy

rm -rf /usr/share/caddy

rm -rf /etc/caddy

3. 卸载V2ray服务
关闭V2ray服务
systemctl stop v2ray

systemctl disable v2ray

卸载V2ray
bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh) --remove
removed: /usr/local/bin/v2ray
removed: /usr/local/share/v2ray
removed: /etc/systemd/system/v2ray.service
removed: /etc/systemd/system/v2ray@.service
removed: /etc/systemd/system/v2ray.service.d
removed: /etc/systemd/system/v2ray@.service.d
Please execute the command: systemctl disable v2ray
You may need to execute a command to remove dependent software: apt purge curl unzip
info: V2Ray has been removed.
info: If necessary, manually delete the configuration and log files.
info: e.g., /usr/local/etc/v2ray and /var/log/v2ray/ ...
4. 卸载Acme证书申请服务
卸载 acme.sh
acme.sh --uninstall

删除 acme.sh 相关文件
rm -rf ~/.acme.sh

5. 重置防火墙端口
command -v firewall-cmd

command -v ufw
/usr/sbin/ufw
ufw delete allow 80/tcp
Rule deleted
Rule deleted (v6)
ufw delete allow 80/udp
Rule deleted
Rule deleted (v6)
ufw delete allow 443/tcp
Rule deleted
Rule deleted (v6)
ufw delete allow 443/udp
Rule deleted
Rule deleted (v6)
yes | ufw reload
Firewall reloaded
卸载完成
卸载完成
sed -i 's/echo/#echo/g' ~/.bashrc

sed -i 's/echo/#echo/g' ~/.profile

id -u
0
1. 检测系统环境
检测系统环境
检测CPU架构
uname -m
x86_64
检测系统安装命令
检测Systemctl
command -v systemctl
/usr/bin/systemctl
检测SELinux
command -v getenforce

2. 卸载Caddy服务
关闭Caddy服务
systemctl stop caddy

systemctl disable caddy

彻底删除Caddy文件
rm -rf /etc/systemd/system/caddy.service

rm -rf /usr/bin/caddy

rm -rf /usr/share/caddy

rm -rf /etc/caddy

3. 卸载V2ray服务
关闭V2ray服务
systemctl stop v2ray

systemctl disable v2ray

卸载V2ray
bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh) --remove
removed: /usr/local/bin/v2ray
removed: /usr/local/share/v2ray
removed: /etc/systemd/system/v2ray.service
removed: /etc/systemd/system/v2ray@.service
removed: /etc/systemd/system/v2ray.service.d
removed: /etc/systemd/system/v2ray@.service.d
Please execute the command: systemctl disable v2ray
You may need to execute a command to remove dependent software: apt purge curl unzip
info: V2Ray has been removed.
info: If necessary, manually delete the configuration and log files.
info: e.g., /usr/local/etc/v2ray and /var/log/v2ray/ ...
4. 卸载Acme证书申请服务
卸载 acme.sh
acme.sh --uninstall

删除 acme.sh 相关文件
rm -rf ~/.acme.sh

5. 重置防火墙端口
command -v firewall-cmd

command -v ufw
/usr/sbin/ufw
ufw delete allow 80/tcp
Could not delete non-existent rule
Could not delete non-existent rule (v6)
ufw delete allow 80/udp
Could not delete non-existent rule
Could not delete non-existent rule (v6)
ufw delete allow 443/tcp
Could not delete non-existent rule
Could not delete non-existent rule (v6)
ufw delete allow 443/udp
Could not delete non-existent rule
Could not delete non-existent rule (v6)
yes | ufw reload
Firewall reloaded
卸载完成
卸载完成
